---
title: "MP3"
author: "Tingwei Hu, Brendan Fox, Minho Heo, Christian Peterson"
date: "2023-03-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpmisc)
```

1. What is the stiffness of the intestine in longitudinal and axial loading? How does the stiffness in these two directions compare?
2. What evidence do you have that an intestinal tube is anisotropic?
3. What do you think the function of anisotropy is in the intestine?
4. Did beam orientation result in different flexural stiffness?
5. Did strain rate affect wood flexural stiffness and did this response vary according to how wet the material was?
6. How would this be important in loads applied to a human skeletal element?
7. In your beam analysis, did you find any evidence of viscoelasticity?


# Introduction
  The third Mini Project involves examining experimental methods for measuring the material and structural properties of biological tissue such as wood and intestine. Material properties are those that are inherent to the material itself and are independent of its size and shape. Structural properties, on the other hand, are related to the size and shape of the material. By understanding these properties, researchers can gain valuable insights into the behavior and performance of biological tissues, which may be useful in a variety of fields, including engineering and medicine.

# Materials and Methods

  The wood bending experiment involves three-point bending of a piece of wood to measure its load and deformation properties. The wood is initially deflected a known distance, and then a cylinder is depressed against the wood at either a slow or fast speed to read the load data from the load cell system. An important factor to consider in this experiment is anisotropy, which refers to the variation in properties of a material along different axes. Wood is an anisotropic material, meaning that its properties can vary depending on the direction in which it is measured. Therefore, it is crucial to take measurements in different orientations to gain a comprehensive understanding of its properties. For procedure, see directions on the course website. No amendments were made to the procedure.  
  
  The pig intestine experiment involves measuring the stress-strain relationship of the intestine by cutting a small strip of the material and stretching it with a known force applied to one end. The stress created within the material causes it to elongate, and we can measure its deformation and derive its stress-strain relationship. The experiment also involves testing the intestine in both axial and circumferential directions to account for and examine anisotropy in the material. For procedure, see directions on the course website.  
  
  Load strain, unload strain (both normalized unit), load (in N), and area (in m^2^) were calculated from experimental data and manually entered into r for further processing analysis. We obtained the slope of the stress-strain curve in both conditions, which corresponds to the stiffness of the material in the elastic region according to $M=EI$, where *M* is stiffness, *E* is Young's modulus, and *I* is second moment area. 

# Results
```{r, intestine axi, message=FALSE,echo=FALSE,fig.cap='**Figure 1**: Stress v. strain curve of the longitudinal loading of the intestine. Specifically, it portrays the increasing stress (addition of nuts weighing 3.2g) added onto the intestine and the resulting strain from it. The best line of fit has a slope of 8.24x10^4^, which represents the stiffness.'}
#all units are SI

#create longitudinal loading data frame
longi.pigdf <- data.frame(
  load.g = c(0.062784,0.125568,0.188352,0.251136,0.31392),
  load.strain = c(0.02666666667,0.05333333333,0.06666666667,0.08,0.1066666667),
  unload.strain = c(0.08,0.09333333333,0.09333333333,0.1066666667,NA),
  area = 0.4/10000
)
#calculate stress and plot stress strain curve
longi.pigdf <- longi.pigdf %>% 
  mutate(stress = load.g/area)
longi.pigdf %>% 
  ggplot(aes(x=load.strain,y=stress))+geom_point()+geom_smooth(method=lm,se=FALSE)+
  stat_poly_eq(aes(label =paste(after_stat(eq.label),after_stat(rr.label), sep = "*\", \"*")))+
  labs(title='Circumferential Stress v. Strain',
       y=expression(Stress~(N/m^{2})))+
  xlab('Strain')

```

```{r,intestine cir,message=FALSE,echo=FALSE,fig.cap=}
#creating circumferential loading data frame
circum.pigdf <- data.frame(
  load.g = c(6.4,12.8,19.2,25.6,32),
  load.strain = c(0.2222222222,0.4444444444,0.4444444444,0.5555555556,0.6666666667),
  unload.strain = c(0.4444444444,0.5555555556,0.5555555556,0.5555555556,NA),
  area = 1.18/10000
)

#calculate stress and plot stress strain curve
circum.pigdf <- circum.pigdf %>% 
  mutate(stress = load.g/area)
circum.pigdf %>% 
  ggplot(aes(x=load.strain,y=stress))+geom_point()+geom_smooth(method=lm,se=FALSE)+
  stat_poly_eq(aes(label =paste(after_stat(eq.label),after_stat(rr.label), sep = "*\", \"*")))+
  labs(title='Circumferential Stress v. Strain',
       y=expression(Stress~(N/m^{2})))+
  xlab('Strain')
```

```{r,message=FALSE,echo=FALSE}
bend.files <- list.files(pattern='*.csv',full.names=FALSE)

benddf <- tibble()

#create date frame with all relevant info
for (i in 1:length(bend.files)){
  metdat <- str_split(bend.files[i], pattern = '_')
  catchdf <- data.frame(
    dry.wet = metdat[[1]][2],
    flat.flip = metdat[[1]][3],
    slow.fast = gsub('.csv','',metdat[[1]][4])
  )
  tmpdf <- read_csv(bend.files[i]) %>% 
    mutate(
      strain = abs(strain), 
      g = abs(g)
    )
  catchdf <- catchdf %>% 
    mutate(force = max(tmpdf$g) / 1000 * 9.81,
           length = 35/1000,
           deflection = 1.5 / 1000) %>% 
    mutate(flx.stiff = (force*(length^3))/(3*deflection))

  #combine all conditions!
  benddf <- rbind(benddf,catchdf)
}

print(benddf)

drydf <- benddf %>% 
  subset(dry.wet == 'dry')

barplot(drydf$flx.stiff,
        names.arg = c('flat.fast','flat.slow','flip.slow'),
        xlab = 'Condition',
        ylab = 'Flexural Stiffness (N/m^2^)',
        main = 'Flexural Stiffness v. Beam Orientation')
```


```{r,strain rate,message=FALSE,echo=FALSE}

flatdf <- benddf %>% 
  subset(flat.flip == 'flat') %>% 
  mutate(flat.flip = NULL,
         force = NULL,
         length = NULL,
         deflection = NULL)

placeholderdf <- tibble()

for (i in 1:length(bend.files)){
  tmpdf <- read_csv(bend.files[i]) %>%
    mutate(strain = abs(strain)) %>%
    select(c('ms','strain'))
  plotdf <- tmpdf[1:which.max(tmpdf$strain),]
  nums <- coef(lm(plotdf$strain ~ plotdf$ms))

  metdat <- str_split(bend.files[i], pattern = '_')
  catchdf <- data.frame(
    dry.wet = metdat[[1]][2],
    slow.fast = gsub('.csv','',metdat[[1]][4]),
    flat.flip = metdat[[1]][3]
  ) %>% 
    mutate(slope = nums[2]) %>% 
    subset(flat.flip == 'flat') %>% 
    mutate(flat.flip = NULL)
  placeholderdf <- rbind(placeholderdf,catchdf)
}

masterdf <- left_join(placeholderdf,flatdf,by = c('dry.wet','slow.fast'))

print(masterdf)

masterdf %>%
  ggplot(aes(slope,flx.stiff,color=dry.wet))+geom_point(size=2.5)+
  xlab('Strain Rate')+
  ylab('Flexural Stiffness (N/m^2^)')+
  labs(title='Strain Rate v. FS by Moisture')+
  ylim(min=0,max=0.08)+
  xlim(min=0,max=150)
```



# Discussion

## Question 1

## Question 2

## Question 3

## Question 4

## Question 5


# Author Contributions
Tingwei Hu: Data analysis and plots

# References
