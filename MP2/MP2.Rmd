---
title: "MP2"
author: "Tingwei Hu, Eugene Yang, Anya Zhong, Andriana Patmanidis"
date: "2023-02-14"
output: html_document
bibliography: BIOL5380.bib
---

```{r setup,include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(av)
library(ggpubr)
library(car)
```
# Introduction
	The classic inverted pendulum (IP) model is a powerful tool for analyzing the Newtonian physics and mechanisms underlying bipedal locomotion. This mathematical model predicts that the square of the maximum velocity is less than or equal to the product of gravity and the pendulum length: $v^2 ≤ gL$. For predicting bipedal locomotion, the IP model suggests that the maximum walking speed is defined as being less than or equal to  $\sqrt{gL}$, where L represents leg length. However, this result may not accurately describe realized human gaits as it fails to consider other elements that contribute to walking such as mass and movement of surrounding structures. To evaluate the IP model’s ability in accurately predicting human walking, we will investigate the difference in maximum walking velocities under pendulum walking and normal walking, and the changes in pelvic tilt angle at various normal walking speeds.

# Methods
## Initial Processing, Data Tidying
```{r, message=FALSE}
walk.files <- list.files()[grep("walk_.*.txt",list.files())]
print(walk.files)

walk.dat <- list() #make a list for storing
for(i in walk.files){
  walk.i <- read_delim(i,delim="\t") #read data as a tibble
  met.dat <- unlist(strsplit(i,"_")) #split i for metadata and unlist it
  speed <- met.dat[2] #get speed
  subject <- gsub(".txt","",met.dat[3]) #remove ".txt" 
  walk.dat[[i]] <- walk.i%>%
    mutate(speed=speed,subject=subject)
}
```

```{r,combine}
walk.dat <- do.call(rbind,walk.dat)
head(walk.dat)
```
```{r,ok}
colnames(walk.dat) <- str_remove(colnames(walk.dat)," \\[pixel\\]| \\[sec\\]")
head(walk.dat)
```
```{r,plot}
walk.dat2 <- walk.dat%>%
  select(TID,PID,x,y,subject,speed)
walk.dat2%>%
  ggplot(aes(x,y,col=speed))+geom_point()+facet_grid(subject~.)
```
```{r,more plots}
walk.dat2 <- walk.dat2%>%
  group_by(speed,subject)%>%
  mutate(y=abs(y-max(y)))
walk.dat2%>%
  ggplot(aes(x,y,col=speed))+geom_point()+facet_grid(subject~.)#grid it with columns = to speed

```

```{r,more}
walk.dat2 <- walk.dat2%>%
  mutate(TID=replace(TID, TID==1, "hipR"))%>%
  mutate(TID=replace(TID, TID==2, "hipC"))
head(walk.dat2)
```
```{r,pivot wide}
walk.wide <- walk.dat2%>%
  pivot_wider(names_from=TID,values_from=c("x","y"))
head(walk.wide)
```

## Calculate Maximum Pelvic Tilt Angle
```{r,tilt angle}
walk.wide <- walk.wide %>%
  mutate(angle = atan(abs(x_hipR-x_hipC)/abs(y_hipR-y_hipC))*180/pi)
```

```{r,max tilt angle}
walk.wide.max <- walk.wide %>% 
  group_by(subject,speed) %>% 
  drop_na(angle) %>% 
  summarise(max=max(angle))
walk.wide.max
```

## Load in Class Data
```{r}
class.gait <- read_csv('class_gait.csv') %>% 
  na.omit()
class.gait
```
# Report Question 1
```{r,froude}
t.test(class.gait$`vmax_ms^-1`,class.gait$`recorded_walking_ms^-1`,paired=TRUE)
```
The class-wide theoretical pendulum walking speed was significantly larger than actual recorded pendulum walking speed.
# Report Question 2
```{r}
class.gait %>% 
  ggplot(aes(x=leg_length_m,y=`recorded_walking_ms^-1`,col=sex))+geom_point()+
  xlab('Leg Length (m)')+
  ylab('Recorded Pendulum Walking Speed (m/s)')+
  ggtitle('Size vs. Pendulum Walking Speed by Sex')

#gait by sex (only) boxplot
class.gait %>% 
  ggplot(aes(x=sex,y=`recorded_walking_ms^-1`))+geom_boxplot()+
  stat_compare_means(method ='t.test')

#leg length by sex
t.test(leg_length_m~sex,data=class.gait)

#analysis of covariance: Vwalking ~ sex + leg_length_m
ancova_model <- aov(`recorded_walking_ms^-1` ~ sex + leg_length_m, data = class.gait)
Anova(ancova_model, type="III") 

```
Our data shows only a slightly significant correlation between walking speed and sex (p=0.048). Females had an average walking speed of 1.29m/s while males had an average speed of 1.43m/s. This data is based on the comparison of males and females during gait, so it is unclear as to exactly which factors contribute to this significant difference. According to an article published by the NCBI, it is anatomically proven that pelvic structural differences exist between biologically male and female persons (@lewis2017human). Females tend to have wider, broader hips while males have a narrower pelvis and a more anteriorly curved sacrum. Differences in bone shape alter the structure of the acetabulum or hip joint, which may cause changes in the motion of walking. The article stated that “it remains unclear if these sex-specific differences during gait are related to specific pelvic structure or to differences in body size and height”. After performing an ANCOVA test that examined the covariance among categorical and continuous variables, it can be concluded that there is no significant difference between sex (p=0.175) or leg length (p=0.394) and gait speed.Therefore, it is not possible to draw concrete conclusions as to how human size and sex impact an individual's gait speed.

# Report Question 3
```{r,}
class.gait2 <- class.gait
colnames(class.gait2)[colnames(class.gait2) == "0"] = "ID"
class.gait2 <- class.gait2 %>%
  group_by(ID) %>%
  summarize(difference= fast_mean_max_pt_angle - norm_mean_max_pt_angle)
class.gait2

ggplot(class.gait2, aes(x= ID, y= difference))+geom_point()+geom_smooth(method= lm, se= FALSE)+annotate("text", x= 15, y= 7, label= (paste0("slope==", coef(lm(class.gait2$difference ~ class.gait2$ID))[2])),parse= TRUE)+labs(caption= "This is my caption") + theme(plot.caption= element_text(hjust=0))+xlab("Individual")+ylab("Difference in Max Mean Pelvic Tilt Angle (deg)")

```



# Report Question 4
```{r, Mass Plot}
ggplot(class.gait, aes(x= Mass_Kg, y= norm_mean_max_pt_angle, color= sex))+geom_point()+ylab("Normal Mean Maximum Pelvic Tilt (deg)") + xlab("Mass (kg)")

```

***Figure ***

```{r, Length Plot}
ggplot(class.gait, aes(x= leg_length_m, y= norm_mean_max_pt_angle, color= sex))+geom_point() + ylab("Normal Mean Maximum Pelvic Tilt (deg)") + xlab("Leg Length (m)")
```

# Author Contributions
Authors contributed equally on all parts of the project.

# References
